/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import{events as e}from"../../common/analytics.js";import{dcLocalStorage as t}from"../../common/local-storage.js";import{util as o}from"./content-util.js";import{privateApi as a}from"./content-privateApi.js";import{OptionPageActions as n,OptionsPageToggles as s}from"../../common/constant.js";await t.init();const i=t.getItem("appLocale");var r,l,d,c,_=!1,p=!1;function E(e,t,a){delete e.trefoilClick,delete e.dataURL,delete e.click_context,e.authenticatedPDF&&1==e.authenticatedPDF&&delete e.authenticatedPDF,o.messageToMain(e,a),delete e.newUI,delete e.trefoilUI,delete e.analytics,delete e.is_viewer,delete e.reload_in_native,l&&(clearTimeout(l),l=null),t||"dismiss"===e.content_op||"resize_window"===e.content_op||I()}function f(){l&&(clearTimeout(l),l=null),SETTINGS.IS_ERP_READER?$(".acrobatMainDiv").stop().css("display","none"):$(".acrobatMainDiv").stop().css("opacity",1)}function T(e){return!!SETTINGS.TEST_MODE||!(!e||!e.show_frictionless||0!=e.version&&(1!=e.version||0!=e.NMHConnStatus)&&e.version!=SETTINGS.READER_VER)}function m(){delete r.current_status,delete r.file_path,delete r.domtitle,delete r.timing,delete r.panel_op,delete r.is_pdf,delete r.trefoilUI,delete r.newUI}function u(e,t){const a={main_op:"analytics",analytics:[[e,t]]};o.messageToMain(a)}function I(){m(),r.content_op="dismiss",r.main_op="relay_to_content",r.trefoilUI=!0,"search"===r.frictionless_workflow&&1==r.show_frictionless&&(r.suppress_frictionless=!0),delete r.newUI,E(r)}function C(t){(r.version>1||SETTINGS.IS_ERP_READER||SETTINGS.IS_READER)&&(0==t?(r.content_op="dismiss",r.main_op="relay_to_content",r.newUI=!0,r.persist=!1,o.analytics(r,e.PERSIST_PDF_MENU_CLOSED),E(r),delete r.content_op,delete r.main_op):1==t&&(r.panel_op="pdf_menu",r.main_op="relay_to_content",r.persist=!0,o.analytics(r,e.PERSIST_PDF_MENU_SHOWN),delete r.content_op,r.newUI=!0,E(r,!0),delete r.persist,delete r.panel_op,delete r.main_op))}function h(){l=null,$(".acrobatMainDiv").animate({opacity:0},1500,"swing",I)}function S(){(SETTINGS.TEST_MODE||SETTINGS.DEBUG_MODE)&&(l=1),l||_||(l=setTimeout((function(){setTimeout(h)}),r.is_pdf?3e3:1500))}async function v(){r.main_op="open_in_acrobat",r.trefoilUI=!0,void 0!==r.paramName&&delete r.paramName;E(await o.handlePDFURL(r,!0),!0)}async function w(e){r.main_op="open_in_acrobat",r.trefoilUI=!1,r.paramName=e,delete r.content_op;E(await o.handlePDFURL(r,!0),!0)}function O(t){r.pdf_action=t,r.main_op="get-frictionless-url",r.frame_visibility="visible",r.frictionless_workflow="trefoil",r.startup_time=Date.now(),"resize_window"==r.content_op&&(r.content_op=null),"createpdf"==t?o.analytics(r,e.FRICTIONLESS_TOOL_SELECTED,{TOOL:"CREATE_PDF"}):"compress-pdf"==t&&o.analytics(r,e.FRICTIONLESS_TOOL_SELECTED,{TOOL:"COMPRESS_PDF"}),E(r,!0)}function R(a,n){a&&function(e){d=e,t.setItem("ViewResultsPref",d?"true":"false"),$(".do_set_open_pref").toggleClass("open-pdf-in-acrobat")}(n),r.main_op="convertToPDFPopupMenu",a&&(r.outputPath=a),E(r,!0),a||(o.analytics(r,e.TREFOIL_HTML_CONVERT_NEW),t.getItem("ViewResultsPref")?d?o.analytics(r,e.TREFOIL_HTML_CONVERT_OPEN_CHANGED):o.analytics(r,e.TREFOIL_HTML_CONVERT_NO_OPEN):o.analytics(r,e.TREFOIL_HTML_CONVERT_OPEN_DEFAULT))}function g(a){r.main_op="appendToExistingPDFPopupMenu",a&&(r.outputPath=a),E(r,!0),a||(o.analytics(r,e.TREFOIL_HTML_CONVERT_APPEND),t.getItem("ViewResultsPref")?d?o.analytics(r,e.TREFOIL_HTML_CONVERT_OPEN_CHANGED):o.analytics(r,e.TREFOIL_HTML_CONVERT_NO_OPEN):o.analytics(r,e.TREFOIL_HTML_CONVERT_OPEN_DEFAULT))}function L(e){try{let t=new URL(r.frictionless_uri);e.origin===t.origin&&(r.main_op="external_msg",r.data=e.data,r.timeStamp=Date.now(),o.messageToMain(r))}catch(e){}}function N(){u(e.TREFOIL_SETTINGS_ICON_CLICKED),chrome.runtime.openOptionsPage((t=>{chrome.runtime.lastError&&u(e.TREFOIL_SETTINGS_FAILED_TO_OPEN)}))}function D(a,n){"true"===n&&t.setItem("viewer-enabled-source","ownership-consent"),t.getWithTTL("ownership-upgrade")&&"false"===n&&(o.analytics(a,e.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP,{SOURCE:"trefoilMenu"}),o.analytics(a,e.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP_EXPERIMENT,{SOURCE:"trefoilMenu",EXPERIMENT:t.getItem("experiment-ownership")}),t.removeItem("ownership-upgrade"),t.removeItem("defaultOwnerShipExperiment"))}function b(){if(!p){p=!0,window.addEventListener("message",L,!1),$(".do_acrobat").click((function(e){let t=$(e.currentTarget);f(),t.hasClass("do_acrobat_FS")?w("FillnSign"):t.hasClass("do_acrobat")&&v()})),$(".do_frictionless_create, .do_frictionless_compress, .do_frictionless_pdf_to_word, .do_frictionless_pdf_to_jpg, .do_frictionless_pdf_to_excel, .do_frictionless_pdf_to_ppt").click((function(t){let a=$(t.currentTarget);f(),o.isEdge()?(r.main_op="go_to_aonline",a.hasClass("do_frictionless_create")?(r.verb="convert_pdf",u(e.FRICTIONLESS_TOOL_SELECTED_CONVERT_PDF)):a.hasClass("do_frictionless_compress")?(r.verb="compress_pdf",u(e.FRICTIONLESS_TOOL_SELECTED_COMPRESS_PDF)):a.hasClass("do_frictionless_pdf_to_word")?(r.verb="pdf_to_word",u(e.FRICTIONLESS_TOOL_SELECTED_PDFTOWORD)):a.hasClass("do_frictionless_pdf_to_jpg")?(r.verb="pdf_to_jpg",u(e.FRICTIONLESS_TOOL_SELECTED_PDFTOJPG)):a.hasClass("do_frictionless_pdf_to_excel")?(r.verb="pdf_to_excel",u(e.FRICTIONLESS_TOOL_SELECTED_PDFTOEXCEL)):a.hasClass("do_frictionless_pdf_to_ppt")&&(r.verb="pdf_to_ppt",u(e.FRICTIONLESS_TOOL_SELECTED_PDFTOPPT)),E(r)):a.hasClass("do_frictionless_create")?O("createpdf"):a.hasClass("do_frictionless_compress")?O("compress-pdf"):a.hasClass("do_frictionless_pdf_to_word")?O("pdf-to-word"):a.hasClass("do_frictionless_pdf_to_jpg")?O("pdf-to-image"):a.hasClass("do_frictionless_pdf_to_excel")?O("pdf-to-excel"):a.hasClass("do_frictionless_pdf_to_ppt")&&O("pdf-to-ppt")})),$(".do_frictionless_edit , .do_frictionless_edit_rotate, .do_frictionless_edit_delete, .do_frictionless_edit_reorder, .do_frictionless_sign_fillandsign, .do_frictionless_sign_requestsignatures").click((function(t){let o=$(t.currentTarget);r.main_op="go_to_aonline",o.hasClass("do_frictionless_edit_rotate")?(r.verb="edit_rotate",u(e.FRICTIONLESS_TOOL_SELECTED_EDIT_ROTATE)):o.hasClass("do_frictionless_edit_delete")?(r.verb="edit_delete",u(e.FRICTIONLESS_TOOL_SELECTED_EDIT_DELETE)):o.hasClass("do_frictionless_edit_reorder")?(r.verb="edit_reorder",u(e.FRICTIONLESS_TOOL_SELECTED_EDIT_REORDER)):o.hasClass("do_frictionless_sign_fillandsign")?(r.verb="fillandsign",u(e.FRICTIONLESS_TOOL_SELECTED_FILL_SIGN)):o.hasClass("do_frictionless_sign_requestsignatures")&&(r.verb="request_signatures",u(e.FRICTIONLESS_TOOL_SELECTED_REQUEST_SIGNATURES)),E(r)})),$(".accordiontoggle").click((function(e){e.preventDefault();let t=$(this);t.next().next().hasClass("show")?(t.next().next().removeClass("show"),t.next().addClass("show"),t.next().css("display","block"),t.next().next().slideUp(0),t.next().delay(0).slideDown(0),t.addClass("stacked"),t.removeClass("collapsed")):(t.next().removeClass("show"),t.next().next().addClass("show"),t.addClass("collapsed"),t.removeClass("stacked"),t.next().slideUp(0),t.next().next().slideDown(0))})),$(".do_visit_acom, .do_html_to_pdf, .go_to_aonline").click((function(t){let a=$(t.currentTarget);f(),a.hasClass("do_visit_acom")&&(r.is_pdf?o.analytics(r,e.TREFOIL_PDF_VISIT_AIC):o.analytics(r,e.TREFOIL_HTML_VISIT_AIC),r.handleResult="acom",r.main_op="goto_acom",E(r)),a.hasClass("do_html_to_pdf")&&R(),a.hasClass("go_to_aonline")&&(r.main_op="go_to_aonline",r.verb="default",E(r),u(e.ACROBAT_ONLINE_CLICKED))})),$(".close-dialog").click((function(){$(".acrobatMainDiv").length>0&&$(".acrobatMainDiv").hasClass("widget-screen-main-div")&&o.analytics(r,e.FRICTIONLESS_WIDGET_CROSS_CLICKED),I()})),$(".settings-dialog").click(N),$(".action-available-click").click((function(t){let a=$(t.currentTarget);f(),o.consoleLog(a),r.main_op="go_to_aonline",r.verb="acrobat_label",u(e.TREFOIL_ACROBAT_LABEL_CLICKED),E(r)})),$(".acrobatMainDiv").hover(f,S),$(".sign-out").click((function(){o.analytics(r,e.SIGN_OUT_CLICKED),r.main_op="sign-out",E(r)})),$("#special").click((function(){o.analytics(r,e.FLICKR_OFFER_CLICKED),r.main_op="flickr",E(r)})),$(".do_html_add_to_pdf").click((function(){g()})),$(".do_set_open_pref").click((function(){d=!(d=$(".do_set_open_pref").hasClass("open-pdf-in-acrobat")),t.setItem("ViewResultsPref",d?"true":"false"),$(".do_set_open_pref").toggleClass("open-pdf-in-acrobat"),d?o.analytics(r,e.TREFOIL_HTML_OPENPDF_PREF_OFF):o.analytics(r,e.TREFOIL_HTML_OPENPDF_PREF_ON),r.main_op="send-analytics",E(r,!0)})),$(".do_set_pdf_viewer").click((async function(){c=$(".do_set_pdf_viewer").hasClass("open_in_pdf_viewer"),D(r,c=!c),t.setItem("pdfViewer",c.toString()),await a.setViewerState(c?"enabled":"disabled");try{t.removeItem("netAccAdT"),t.removeItem("netAcc"),t.removeItem("netAccCN")}catch(e){}$(".do_set_pdf_viewer").toggleClass("open_in_pdf_viewer"),c?o.isEdge()?o.analytics(r,e.USE_ACROBAT_IN_EDGE_ENABLED):o.isChrome()&&o.analytics(r,e.USE_ACROBAT_IN_CHROME_ENABLED):o.isEdge()?o.analytics(r,e.USE_ACROBAT_IN_EDGE_DISABLED):o.isChrome()&&o.analytics(r,e.USE_ACROBAT_IN_CHROME_DISABLED),setTimeout((()=>{r.is_viewer?E({panel_op:"viewer_menu",reload_in_native:!0,tabId:r.tabId},!0):r.is_pdf&&chrome.tabs.reload(),r.main_op="send-analytics",E(r,!0)}),20)})),$(".do-acro-prefs").click((function(){o.analytics(r,e.TREFOIL_HTML_PREFERENCES_CLICK),r.main_op="showConversionSettingsDialog",E(r)})),$(".convert").click((function(){$(".convert").hasClass("convert-button")&&(r.main_op="open_converted_file",E(r))})),$(".always-show").prop("checked","false"!==t.getItem("always-show-pdf-menu")),$(".api-option-container-inner").click((function(){let e=$(".always-show").prop("checked")?"false":"true";t.setItem("always-show-pdf-menu",e),$(".always-show").prop("checked","true"===e),"false"===e?C(!1):"true"===e&&C(!0)})),$(".always-show-pdftools").prop("checked","false"!==t.getItem("always-show-pdftools"));const i="true"===t.getItem("pdfViewer");$(".always-show-pdfvieweroption").prop("checked",i),i&&$(".do_set_pdf_viewer").addClass("open_in_pdf_viewer"),$(".api-option-container-inner-pdftools").click((function(){$(".desktop-app-reader .api-option-container input[type=checkbox] ~ .checkbox-toggle").removeClass("toggle-inactive-blue-circle");let o=$(".always-show-pdftools").prop("checked")?"false":"true";t.setItem("always-show-pdftools",o),$(".always-show-pdftools").prop("checked","true"===o),u("false"===o?e.FRICTIONLESS_AUTO_SUGGESTION_DISABLED:e.FRICTIONLESS_AUTO_SUGGESTION_ENABLED)})),$(".api-option-container-inner-pdfvieweroption").click((async function(){$(".desktop-app-reader .api-option-container input[type=checkbox] ~ .checkbox-toggle").removeClass("toggle-inactive-blue-circle");let i=$(".always-show-pdfvieweroption").prop("checked")?"false":"true";const l="true"===i?"enabled":"disabled";D(r,i),t.setItem("pdfViewer",i),await a.setViewerState(l);try{t.removeItem("netAccAdT"),t.removeItem("netAcc"),t.removeItem("netAccCN")}catch(e){}$(".always-show-pdfvieweroption").prop("checked","true"===i),"false"===i?o.isEdge()?o.analytics(r,e.USE_ACROBAT_IN_EDGE_DISABLED):o.isChrome()&&o.analytics(r,e.USE_ACROBAT_IN_CHROME_DISABLED):o.isEdge()?o.analytics(r,e.USE_ACROBAT_IN_EDGE_ENABLED):o.isChrome()&&o.analytics(r,e.USE_ACROBAT_IN_CHROME_ENABLED),setTimeout((()=>{r.is_viewer?E({panel_op:"viewer_menu",reload_in_native:!0,tabId:r.tabId},!0):r.is_pdf&&chrome.tabs.reload(),E({panel_op:"options_page",requestType:n.OPTIONS_UPDATE_TOGGLE,toggleId:s.ViewerOwnershipTitle,toggleVal:"true"===i},!0),r.main_op="send-analytics",E(r,!0),o.isEdge()&&E({main_op:"pdfViewerChanged",value:i})}),20)}))}}function A(a){let n,s,l,d=!0,c=!0,p=!1,m="web2pdfStatusFailure",I="web2pdfStatusComplete";if(r&&a&&r.tabId&&a.tabId&&a.tabId!=r.tabId)return;if(!a.main_op||!["analytics","save-preferences","fetch-preferences","userSubscriptionData"].includes(a.main_op)){if(a.test_extension)return function(e){switch(o.consoleLog("TESTING"),o.consoleLogDir(JSON.stringify(e)),e.test_extension){case"to_html":R(e.outputPath,e.openPDF);break;case"doAcrobat":v();break;case"doAcrobat_FS":w("FillnSign");break;case"to_append":g(e.outputPath)}}(a);switch(a.version===SETTINGS.ERP_READER_VER&&(SETTINGS.IS_ERP_READER=!0),b(),delete(r={...a,tabId:r.tabId}).analytics,f(),_=!1,o.translateElements(".translate"),1===r.version&&$("#web2pdfOpenButtonText").val(o.getTranslation("web2pdfOpenButtonTextOlder")),1!==r.version&&0!==r.version||$("#web2pdfShowPersistentOpen").text(o.getTranslation("web2pdfAlwaysShow")),r.version===SETTINGS.READER_VER&&$("#web2pdfOpenButtonText").val(o.getTranslation("web2pdfOpenButtonText")),$(".ui-element").addClass("hidden"),$("#action_message").text(""),function(e,t){if(SETTINGS.DEBUG_MODE){let a,n=[t];for(a in e)e.hasOwnProperty(a)&&n.push("  "+a+": "+e[a]);o.consoleLog(n.join("\n"))}}(r,"Receive frame message:"),s=r.panel_op,delete r.panel_op,s){case"pdf_menu":_=!0,!0===SETTINGS.FILL_N_SIGN_ENABLED&&($("#web2pdfFillSignAcrobatButtonText").removeClass("hidden"),$(".acro-option.pdf").removeClass("hidden")),1==r.version&&0==r.NMHConnStatus||0==r.version?($(".go_to_aonline").removeClass("hidden"),r.show_frictionless||$(".do_visit_acom").addClass("hidden")):r.version===SETTINGS.READER_VER?($(".acro-option.pdf").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden"),$(".acrobatMainDiv").removeClass("home-screen"),$(".acrobatMainDiv").addClass("pdf-screen"),$(".reader-option.pdf.horizontal-rule.pref-divider").removeClass("hidden")):($(".acro-option.pdf").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").removeClass("hidden")),function(){if(SETTINGS.VIEWER_ENABLED&&!r.incognito){let e=!(0==r.version||1==r.version||r.version===SETTINGS.READER_VER||r.version===SETTINGS.ERP_READER_VER);$(".acro-option-reader-pdf").removeClass("hidden"),$(".acro-option-reader-conditional").addClass("hidden"),!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&e&&($(".acro-option-reader-pdf").addClass("hidden"),$(".acro-option-reader-conditional").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden")),r.version<2||r.version===SETTINGS.READER_VER||($(".acro-option-reader-pdf").addClass("viewer-api-option-container"),$(".acro-option-reader-conditional").addClass("viewer-api-option-container")),r.version>1&&SETTINGS.VIEWER_SHOW_OPEN_IN_ACRO&&(10===parseInt(t.getItem("fteDenied"))||"false"===t.getItem("pdfViewer"))&&$(".acro-option-reader-conditional").removeClass("hidden")}}();break;case"viewer_menu":_=!0,SETTINGS.VIEWER_ENABLED&&!r.incognito&&($(".acro-option-reader-pdf").removeClass("hidden"),$(".acrobatMainDiv").css("width","-webkit-fill-available"),$(".status-dialog").css("width","-webkit-fill-available"),(r.version<2||r.version===SETTINGS.READER_VER)&&$(".api-option-container-inner-pdfvieweroption").css("padding-left","6px"));break;case"error":$(".error").removeClass("hidden").text("Unexpected Error:"+r.error.name+"\nReference: "+r.error.errnum+"\n"+r.error.details);break;case"flickr":$(".action-available").removeClass("hidden"),$("#action_message").text("Create slide shows and contact sheets."),$(".special_question").removeClass("hidden"),$("#special").removeClass("hidden");break;case"status":$(".progress-area").removeClass("hidden"),$(".convert").text(r.domtitle),$(".convert-status, .convert-title").addClass("hidden"),$(".convert").removeClass("convert-button hidden"),"waiting"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_WAITING),n=o.getTranslation("web2pdfStatusWaiting"),d=!1):"downloading"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_DOWNLOADING),n=o.getTranslation("web2pdfStatusDownloading"),d=!1):"in_progress"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_IN_PROGRESS),n=o.getTranslation("web2pdfStatusInProgress"),d=!1):"filelocked"===r.current_status?n=o.getTranslation("web2pdfFileLockedError"):"cancelled"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_CANCELLED),n=o.getTranslation("web2pdfStatusCancelled"),p=!0):"complete"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_COMPLETE),r.file_path?($(".convert").text(o.getTranslation("web2pdfOpenInDCButtonText")),$(".convert").addClass("convert-button")):($(".convert").empty(),$(".convert").addClass("hidden"))):"failure"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_FAILED),r.message&&(n=r.message,n=$("<div/>").text(n).html()),c=!1):"noacrobat"===r.current_status?(o.analytics(r,e.TREFOIL_HTML_CONVERT_NO_ACROBAT),n=o.getTranslation("web2pdfUnsupportedAcrobatVersion"),c=!1):"unknown"===r.current_status?(n=o.getTranslation("web2pdfStatusUnknownFailure"),c=!1):"pdf_downloading"===r.current_status?(n=o.getTranslation("web2pdfStatusDownloadingPDF"),d=!1):"pdf_failure"===r.current_status?(o.analytics(r,e.TREFOIL_PDF_DOWNLOAD_FAILED),m="web2pdfStatusUnknownFailure",c=!1):"pdf_downloaded"===r.current_status?(n=o.getTranslation("web2pdfPDFOpening"),d=!1):"pdf_opened"===r.current_status?(c=!0,I="web2pdfPDFOpened"):"pdf_open_failed"===r.current_status&&(c=!1,d=!0,m="web2pdfPDFOpenFailed"),n&&($(".convert-title").removeClass("hidden"),$(".convert-title").html(n)),d?(delete r.panel_op,l=r.is_pdf?".acro-option.pdf":".acro-option.html",$(l).removeClass("hidden"),$(".actions").removeClass("hidden"),$(".acro-option-conditional.html").addClass("hidden"),SETTINGS.VIEWER_ENABLED&&!r.incognito&&(!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&r.version>1&&!SETTINGS.IS_ERP_READER&&!SETTINGS.IS_READER&&($(".acro-option-conditional.html").addClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden")),$(".status-dialog").css("width","-webkit-fill-available")),$(".convert").removeClass("convert-busy"),$(".convert-status").removeClass("hidden"),c?r.is_pdf?($(".progress-area").addClass("hidden"),$(".convert").removeClass("convert-busy"),$(".convert-status").addClass("hidden")):($(".convert-status-icon").addClass("icon-success"),$(".convert-status-title").text(o.getTranslation(I))):(_=!0,$(".convert-status-icon").removeClass("icon-success"),$(".convert-status-icon").addClass("icon-error"),$(".convert-status-title").text(o.getTranslation(m)),$(".convert").addClass("hidden")),p&&($(".convert-status").addClass("hidden"),$(".convert").addClass("hidden"))):(_=!0,$(".actions").addClass("hidden"),$(".convert").addClass("convert-busy"));break;case"html_menu":_=!0,T(r)?($(".reader-option.html").removeClass("hidden"),o.isEdge()&&$(".chrome-only").addClass("hidden"),SETTINGS.VIEWER_ENABLED||$(".acro-option-reader-pdf").addClass("hidden"),_=!0):($(".acro-option.html").removeClass("hidden"),$(".acro-option-conditional.html").addClass("hidden"),SETTINGS.VIEWER_ENABLED&&!r.incognito&&($(".acro-option-conditional.html").removeClass("hidden"),!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&r.version>1&&!SETTINGS.IS_ERP_READER&&!SETTINGS.IS_READER&&$(".acro-option-conditional.html").addClass("hidden"),$(".status-dialog").css("width","-webkit-fill-available")));break;case"load-frictionless":if(_=!0,"resize_window"===r.content_op);else if(1==r.hide_spinner)delete r.hide_spinner,$(".frictionless-container").removeClass("hidden"),$(".frictionless-loader").addClass("hidden");else if(0==$(".frictionless-container").children().length){$(".acrobatMainDiv").removeClass("home-screen"),$(".acrobatMainDiv").addClass("widget-screen-main-div"),$(".actions").addClass("hidden"),"trefoil"===r.frictionless_workflow&&($(".frictionless-loader").removeClass("hidden"),$(".frictionless-loader").attr("data-loading-title",o.getTranslation("web2pdfLoaderTitle")||"Loading..."),$(".frictionless-container").addClass("hidden"));let a=function(o,a){let n=document.createElement("iframe");n.setAttribute("referrerpolicy","no-referrer"),n.classList.add("frictionless-iframe");let s=new URL(o);if(a&&(i?a.locale=i:r.locale?a.locale=r.locale:a.locale=chrome.i18n.getMessage("@@ui_locale"),Object.keys(a).forEach((e=>{s.searchParams.append(e,a[e])}))),"false"===t.getItem("logAnalytics")){let e=s.toString();e=e.concat("&app!analytics=disable");try{s=new URL(e)}catch(e){s=""}}if("test"===r.env||"stage"===r.env){let e=s.toString();e=e.concat("&app!versions=latest");try{s=new URL(e)}catch(e){s=""}}return n.onerror=function(t){u(e.FRICTIONLESS_WIDGET_LOADING_FAILED)},n.onload=function(e){E({iframe_onload_time:Date.now(),main_op:"timing_info",timing_op:"startup_to_iframe_load"},!0),"trefoil"===a.workflow&&n.contentWindow.postMessage({valid:!0},s.origin)},E({iframe_call_time:Date.now(),main_op:"timing_info"},!0),n.setAttribute("src",s),n}(r.frictionless_uri,{verb:r.pdf_action,workflow:r.frictionless_workflow,dropzone2:"true"});$(".frictionless-container").append(a),$(".frictionless-host").removeClass("hidden"),y()}break;case"show-frictionless-error":if(r.error_title&&r.error_description){let e=r.error_title,t=r.error_description;delete r.error_title,delete r.error_description,function(e,t){const o=$(".frictionless-error"),a=$(".error-title");$(".error-details").text(t),a.text(e),o.removeClass("hidden"),y()}(e,t)}break;case"clear-frictionless-error":$(".frictionless-error").addClass("hidden"),y();break;case"send-external-msg":try{let e=new URL(r.frictionless_uri),t=$(".frictionless-iframe");if(1==t.length){t[0].contentWindow.postMessage(r.data,e.origin),delete r.data}}catch(e){}_=!0}S()}}function y(){m(),r.content_op="resize_window",r.panel_op="load-frictionless",r.main_op="relay_to_content",delete r.newUI,delete r.trefoilUI,E(r),r.content_op=null,r.panel_op=null}o.isChrome()&&$((function(){b()})),o.addMainListener(A),$((function(){if(window.location.search){if(r=JSON.parse(decodeURIComponent(window.location.search.split("=")[1])),SETTINGS.TEST_MODE&&window.addEventListener("message",(function(e){A(e.data)}),!1),T(r)){let t;switch($(".do_visit_acom").addClass("hidden"),$("body").addClass("desktop-app-reader"),"html_menu"==r.panel_op&&($(".acrobatMainDiv").addClass("home-screen"),u(e.FRICTIONLESS_HOME_SCREEN_SHOWN)),i||r.locale){case"ja-JP":t={kitId:"vaq7mqd",scriptTimeout:3e3,async:!0};break;case"ko-KR":t={kitId:"leb2lwu",scriptTimeout:3e3,async:!0};break;case"zh_CN":t={kitId:"eyt7cbr",scriptTimeout:3e3,async:!0}}t&&(function(e){let o,a=e.documentElement,n=setTimeout((function(){a.className=a.className.replace(/\bwf-loading\b/g,"")+" wf-inactive"}),t.scriptTimeout),s=e.createElement("script"),i=!1,r=e.getElementsByTagName("script")[0];a.className+=" wf-loading",s.src="https://use.typekit.net/"+t.kitId+".js",s.async=!0,s.onload=s.onreadystatechange=function(){if(o=this.readyState,!(i||o&&"complete"!=o&&"loaded"!=o)){i=!0,clearTimeout(n);try{Typekit.load(t)}catch(e){}}},r.parentNode.insertBefore(s,r)}(document),function(){let e,t={"font-weight":"400"},o={"font-weight":"500"};switch(i||r.locale){case"ja-JP":e={"font-family":"adobe-clean-han-japanese"};break;case"ko-KR":e={"font-family":"adobe-clean-han-korean"};case"zh_CN":e={"font-famiy":"adobe-clean-han-simplified-c"}}e&&($(".desktop-app-reader").css(e),$(".desktop-app-reader .actions input[type=button]").css(e).css(t),$(".desktop-app-reader .action-available").css(e).css(o))}())}!function(e){var t;void 0!==(t=e)&&void 0!==t.paramName&&delete t.paramName,SETTINGS.FILL_N_SIGN_ENABLED=e.isFillnSignEnabled,SETTINGS.SHAREPOINT_ENABLED=e.isSharePointEnabled,A(e)}(r),"false"===t.getItem("ViewResultsPref")?d=!1:($(".do_set_open_pref").addClass("open-pdf-in-acrobat"),d=!0)}}));